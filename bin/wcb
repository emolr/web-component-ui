#!/usr/bin/env node
const process = require('process');
const program = require('commander');
const runner = require('../runner');
const execSync = require("child_process").execSync;
const path = require('path');
const rootPath = path.resolve(process.mainModule.filename, '..', '..');

const cwd = process.cwd();
const gulp = runner.gulp.run({directory: cwd})

program
    .version('0.0.1')
    .option('-w, --watch', 'Keep watching for changes')
    .option('-e, --env [env]', 'environments [prod]')
    .option('-s, --serve', 'Serve documentation')
    .parse(process.argv);

if (!program.watch) {
    if (program.env === 'prod') {
        gulp.build({production: true}).then(() => {
            console.log('Production build done') 

            if (program.serve) {
                runner.bs.init(cwd);
            }
        });
    } else {
        gulp.build().then(() => {
            console.log('Development build done')

            if (program.serve) {
                runner.bs.init(cwd);
            }
        }).catch(err => {
            console.log(err)
        });
    }
} else {
    if (program.env === 'prod') {
        gulp.watch({production: true}).then(() => {
            if (program.serve) {
                runner.bs.init(cwd);
            }
        }).catch(err => {
            console.log(err)
        });
    } else {
        gulp.watch().then(() => {
            if (program.serve) {
                runner.bs.init(cwd);
            }
        }).catch(err => {
            console.log(err)
        });
    }
}
